<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zo√™</title>

<style>
*{ box-sizing:border-box; }
body{
  margin:0;
  background:#e5e7eb;
  display:flex;
  justify-content:center;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}
.phone{
  width:100%;
  max-width:420px;
  min-height:100vh;
  background:#f8fafc;
  position:relative;
}
header{
  background:#22c55e;
  color:#fff;
  padding:16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:600;
}
header button{
  background:#fff;
  color:#22c55e;
  border:none;
  padding:6px 14px;
  border-radius:18px;
  font-weight:600;
  cursor:pointer;
}
main{ padding:16px; }
.card{
  background:#fff;
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
}
.card img{
  width:100%;
  border-radius:12px;
  margin-bottom:10px;
}
.btn{
  background:#f97316;
  color:#fff;
  border:none;
  padding:12px;
  width:100%;
  border-radius:12px;
  margin-top:10px;
  cursor:pointer;
  font-weight:600;
}
.btn.green{ background:#22c55e; }
.btn.blue{ background:#2563eb; }
.btn.gray{ background:#e5e7eb; color:#111; }
.progress{
  background:#e5e7eb;
  height:8px;
  border-radius:8px;
  overflow:hidden;
  margin-top:6px;
}
.progress-fill{
  background:#22c55e;
  height:100%;
}
.value-buttons{
  display:flex;
  gap:8px;
  margin:10px 0;
}
.value-buttons button{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:2px solid #22c55e;
  background:#fff;
  color:#22c55e;
  font-weight:600;
}
.value-buttons button.active{
  background:#22c55e;
  color:#fff;
}
input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
  margin-top:8px;
}
.nav{
  position:absolute;
  top:60px;
  right:16px;
  background:#fff;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
  display:none;
  flex-direction:column;
  min-width:180px;
  z-index:999;
}
.nav div{
  padding:14px 16px;
  cursor:pointer;
  border-bottom:1px solid #eee;
}
.nav div:last-child{ border-bottom:none; }
</style>
</head>

<body>
<div class="phone">

<header>
  <span>Zo√™</span>
  <button onclick="toggleMenu()">‚ò∞</button>
</header>

<main id="screen"></main>
<div id="paymentScreen" style="display:none;padding:16px;"></div>

<div class="nav" id="menu">
  <div onclick="renderHome()">In√≠cio</div>
  <div onclick="renderDonations()">Doa√ß√µes</div>
  <div onclick="renderTransparency()">Transpar√™ncia</div>
  <div onclick="renderProfile()">Perfil</div>
  <div onclick="logout()" style="color:#dc2626;font-weight:600">Sair</div>
</div>

<script>
// ===== LOGIN (SEM LOOP) =====
const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
const tipoCadastro = localStorage.getItem("tipoCadastro");

if(!usuario){
  document.getElementById("screen").innerHTML = `
    <div class="card" style="text-align:center">
      <h3>Acesso restrito</h3>
      <p>Voc√™ precisa fazer login para acessar o Zo√™.</p>
      <button class="btn green" onclick="location.href='index.html'">
        Ir para login
      </button>
    </div>
  `;
  throw new Error("Usu√°rio n√£o logado");
}

function logout(){
  localStorage.removeItem("usuarioLogado");
  location.href="index.html";
}

// ===== MENU =====
function toggleMenu(){
  const m=document.getElementById("menu");
  m.style.display=m.style.display==="flex"?"none":"flex";
}

// ===== DADOS =====
const families = [
  { name:"Fam√≠lia Silva", image:"assets/familia1.jpeg", goal:1800, raised:720 },
  { name:"Fam√≠lia Pereira", image:"assets/familia2.jpeg", goal:900, raised:300 },
  { name:"Fam√≠lia Rocha", image:"assets/familia3.jpeg", goal:1500, raised:0 },
  { name:"Fam√≠lia do Amor", image:"assets/familia4.jpeg", goal:2000, raised:0 },
  { name:"Fam√≠lia Santos", image:"assets/familia5.jpeg", goal:1200, raised:0 },
  { name:"Fam√≠lia Ferreira", image:"assets/familia6.jpeg", goal:1800, raised:0 },
  { name:"Fam√≠lia Nunes", image:"assets/familia7.jpeg", goal:900, raised:0 },
  { name:"Fam√≠lia Costa", image:"assets/familia8.jpeg", goal:1600, raised:0 },
  { name:"Fam√≠lia Lima", image:"assets/familia9.jpeg", goal:1400, raised:0 }
];

// ===== RELAT√ìRIO =====
let relatorio = JSON.parse(localStorage.getItem("relatorio")) || [];
function registrarDoacao(forma){
  relatorio.push({
    nome: usuario.email.split("@")[0],
    email: usuario.email,
    cpf: localStorage.getItem("cpfUsuario") || "N√£o informado",
    forma,
    familia: familiaAtual,
    valor: valorSelecionado,
    data: new Date().toLocaleString("pt-BR")
  });
  localStorage.setItem("relatorio", JSON.stringify(relatorio));
}

let familiaAtual="";
let valorSelecionado=0;

// ===== TELAS =====
function renderHome(){
  document.getElementById("menu").style.display="none";
  document.getElementById("paymentScreen").style.display="none";
  const s=document.getElementById("screen");
  s.style.display="block";

  s.innerHTML=`
    <div class="card">
      <h3>Bem-vindo(a)!</h3>
      <p>Ajude fam√≠lias no Maraj√≥ atrav√©s do apadrinhamento.</p>
    </div>
  `;

  families.forEach(f=>{
    const percent=Math.min((f.raised/f.goal)*100,100);
    s.innerHTML+=`
      <div class="card">
        <img src="${f.image}">
        <strong>${f.name}</strong>
        <p>R$ ${f.raised} / R$ ${f.goal}</p>
        <div class="progress">
          <div class="progress-fill" style="width:${percent}%"></div>
        </div>
        <button class="btn" onclick="abrirPagamento('${f.name}')">
          Apadrinhar
        </button>
      </div>
    `;
  });
}

function renderProfile(){
  document.getElementById("menu").style.display="none";
  document.getElementById("screen").innerHTML=`
    <div class="card">
      <h3>Meu Perfil</h3>
      <p><strong>Email:</strong><br>${usuario.email}</p>
      <p><strong>Tipo de cadastro:</strong><br>${tipoCadastro||"N√£o informado"}</p>
      <button class="btn gray" onclick="renderHome()">‚Üê Voltar</button>
    </div>
  `;
}

function renderDonations(){
  document.getElementById("menu").style.display="none";
  document.getElementById("screen").innerHTML=
    `<div class="card"><h3>Doa√ß√µes</h3><p>Hist√≥rico em breve.</p></div>`;
}

function renderTransparency(){
  document.getElementById("menu").style.display="none";
  document.getElementById("paymentScreen").style.display="none";
  const s=document.getElementById("screen");
  s.style.display="block";

  if(relatorio.length===0){
    s.innerHTML=`<div class="card"><h3>Transpar√™ncia</h3><p>Nenhuma doa√ß√£o registrada.</p></div>`;
    return;
  }

  let html=`<div class="card"><h3>Relat√≥rio de Doa√ß√µes</h3></div>`;
  relatorio.forEach(d=>{
    html+=`
      <div class="card" style="font-size:14px">
        <strong>Doador:</strong> ${d.nome}<br>
        <strong>Email:</strong> ${d.email}<br>
        <strong>CPF:</strong> ${d.cpf}<br>
        <strong>Forma:</strong> ${d.forma}<br>
        <strong>Fam√≠lia:</strong> ${d.familia}<br>
        <strong>Valor:</strong> R$ ${Number(d.valor).toFixed(2)}<br>
        <strong>Data:</strong> ${d.data}
      </div>
    `;
  });
  s.innerHTML=html;
}

// ===== PAGAMENTO =====
function abrirPagamento(nome){
  familiaAtual=nome;
  document.getElementById("screen").style.display="none";
  const p=document.getElementById("paymentScreen");
  p.style.display="block";

  p.innerHTML=`
    <div class="card">
      <h3>Forma de pagamento</h3>
      <p><strong>${nome}</strong></p>
      <button class="btn green" onclick="abrirPix()">üíö Pix</button>
      <button class="btn blue" onclick="abrirCartao()">üí≥ Cart√£o</button>
      <button class="btn gray" onclick="renderHome()">‚Üê Voltar</button>
    </div>`;
}

function abrirPix(){
  valorSelecionado=0;
  const p=document.getElementById("paymentScreen");
  p.innerHTML=`
    <div class="card">
      <h3>Pagamento via Pix</h3>
      <p><strong>${familiaAtual}</strong></p>

      <div class="value-buttons">
        <button onclick="setValor(10,this)">R$ 10</button>
        <button onclick="setValor(50,this)">R$ 50</button>
        <button onclick="setValor(100,this)">R$ 100</button>
      </div>

      <input id="valorInput" type="number"
        placeholder="Outro valor (R$)"
        oninput="setValor(this.value)">

      <button class="btn green" onclick="gerarPix()">Fazer pagamento</button>
      <button class="btn gray" onclick="abrirPagamento(familiaAtual)">‚Üê Voltar</button>
    </div>`;
}

function setValor(valor,btn=null){
  valorSelecionado=Number(valor)||0;
  const i=document.getElementById("valorInput");
  if(i) i.value=valorSelecionado||"";
  document.querySelectorAll(".value-buttons button")
    .forEach(b=>b.classList.remove("active"));
  if(btn) btn.classList.add("active");
}

function gerarPix(){
  if(valorSelecionado<=0){ alert("Informe um valor"); return; }
  const p=document.getElementById("paymentScreen");
  p.innerHTML=`
    <div class="card" style="text-align:center">
      <h3>PIX</h3>
      <p>Valor: <strong>R$ ${valorSelecionado.toFixed(2)}</strong></p>
      <img src="assets/qrcode-pix.jpg" style="width:220px;margin:12px auto">
      <p id="pixCode" style="font-size:12px;word-break:break-all">
        PIX-ZOE-${valorSelecionado}
      </p>
      <button class="btn" onclick="copiarPix()">Copiar c√≥digo</button>
      <button class="btn green" onclick="registrarDoacao('Pix'); sucesso()">J√° paguei</button>
    </div>`;
}

function copiarPix(){
  navigator.clipboard.writeText(document.getElementById("pixCode").innerText);
  alert("C√≥digo PIX copiado");
}

function abrirCartao(){
  const p=document.getElementById("paymentScreen");
  p.innerHTML=`
    <div class="card">
      <h3>Pagamento com Cart√£o</h3>
      <p><strong>${familiaAtual}</strong></p>
      <input placeholder="Nome no cart√£o">
      <input placeholder="N√∫mero do cart√£o">
      <input placeholder="Validade">
      <input placeholder="CVV">
      <button class="btn blue" onclick="registrarDoacao('Cart√£o'); sucesso()">Pagar</button>
      <button class="btn gray" onclick="abrirPagamento(familiaAtual)">‚Üê Voltar</button>
    </div>`;
}

function sucesso(){
  document.getElementById("paymentScreen").innerHTML=`
    <div class="card" style="text-align:center">
      <h2>‚ù§Ô∏è Obrigado!</h2>
      <p>Doa√ß√£o registrada com sucesso.</p>
    </div>`;
  setTimeout(renderHome,3000);
}

// START
renderHome();
</script>

</div>
</body>
</html>
